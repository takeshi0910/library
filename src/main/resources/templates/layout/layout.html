<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">Âõ≥Êõ∏È§®„Ç¢„Éó„É™</title>
    <!-- ÂÑ™ÂÖàÈ†Ü„ÇíË™øÊï¥„Åó„ÅüÊõ∏„ÅçÊñπÔºàBootstrap„ÇíÂÑ™ÂÖà„Åô„ÇãÂ†¥ÂêàÔºâ -->
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/webjars/vue/3.4.21/dist/vue.global.prod.js}"></script>
    <script th:src="@{/webjars/axios/1.6.7/dist/axios.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/common.js}"></script>

    <style>
        /* „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éº */
        .dropdown-menu {
          opacity: 0;
          transform: translateY(-5px);
          transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .dropdown-menu.show {
          opacity: 1;
          transform: translateY(0);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>

</head>
<!-- javascript„Åß„ÅÆÊ®©ÈôêÊÉÖÂ†±ÂèÇÁÖßÁî®„Å´„ÄÅdata-roleÂ±ûÊÄß„ÇíÂüã„ÇÅËæº„ÇÄ -->
<body th:attr="data-role=${#authentication.authorities.?[getAuthority() == 'ROLE_ADMIN'].size() > 0 ? 'ADMIN' : 'USER'}">

<script>
    const dropdown = document.getElementById('userDropdown');
    if (dropdown) {
      dropdown.addEventListener('show.bs.dropdown', function () {
        const menu = document.querySelector('.dropdown-menu');
        if (menu) menu.classList.add('show');
      });

      dropdown.addEventListener('hide.bs.dropdown', function () {
        const menu = document.querySelector('.dropdown-menu');
        if (menu) menu.classList.remove('show');
      });
    }
</script>
<div class="wrapper d-flex min-vh-100">

    <header class="bg-ivory-deep border-bottom shadow-sm nowrap">
        <div class="container py-3">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h4 mb-0 app-title">
                    <i class="fas fa-book me-2"></i> Library App - Âõ≥Êõ∏È§®„Ç¢„Éó„É™
                </h1>

                <!-- üëá „Åì„Åì„Å´„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„ÉºÂêç„ÇíË°®Á§∫ -->
                <div class="d-flex align-items-center gap-3">
                    <nav class="d-flex gap-3">
                        <a th:href="@{/}" th:class="'nav-link ' + (${requestUri == '/' ? 'active' : ''})">
                            <i class="fas fa-house-chimney"></i> HOME - „Éõ„Éº„É†
                        </a>
                        <a th:href="@{/books}" th:class="'nav-link ' + (${requestUri == '/books' ? 'active' : ''})">
                            <i class="fas fa-book"></i> LIST - ‰∏ÄË¶ß
                        </a>
                        <a sec:authorize="hasRole('ADMIN')"
                           th:href="@{/books/form}"
                           th:class="'nav-link ' + (${requestUri == '/books/form' ? 'active' : ''})">
                            <i class="fas fa-pen-to-square"></i> ADD - ÁôªÈå≤
                        </a>
                    </nav>

                    <!-- üë§ „É≠„Ç∞„Ç§„É≥Ê∏à„Åø„É¶„Éº„Ç∂„Éº -->
                    <div th:if="${displayName != null}" class="dropdown ms-5">
                        <a
                                class="nav-link dropdown-toggle text-secondary"
                                href="#"
                                id="userDropdown"
                                role="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false"
                        >
                            <i class="fas fa-user-circle me-1 text-primary"></i>
                            <strong th:text="${displayName}">„É¶„Éº„Ç∂„ÉºÂêç</strong> Êßò
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" th:href="@{/users/edit}">
                                <i class="fas fa-user-gear me-2"></i> „Ç¢„Ç´„Ç¶„É≥„ÉàÊÉÖÂ†±„ÅÆÁ∑®ÈõÜ
                                <!-- getÈÄö‰ø°„Åò„ÇÉÂç±Èô∫„Å™„Åç„Åå„Åô„Çã -->
                            </a>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <!--/* „É≠„Ç∞„Ç¢„Ç¶„Éà„É™„É≥„ÇØ„ÄÇ
                            Spring Security „ÅÆÊ®ôÊ∫ñÊ©üËÉΩ„Å´„Çà„Çä /logout „Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Å®„Çª„ÉÉ„Ç∑„Éß„É≥Á†¥Ê£Ñ„Åï„Çå„Çã„ÄÇ
                            */-->
                            <li><a class="dropdown-item" th:href="@{/logout}">
                                <i class="fas fa-right-from-bracket me-2"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
                            </a></li>
                        </ul>
                    </div>

                    <!-- üë• „Ç≤„Çπ„ÉàË°®Á§∫Ôºà„É≠„Ç∞„Ç§„É≥„É™„É≥„ÇØ‰ªò„Åç„Éó„É´„ÉÄ„Ç¶„É≥Ôºâ -->
                    <div th:if="${displayName == null}" class="dropdown ms-5">
                        <a
                                class="nav-link dropdown-toggle text-muted"
                                href="#"
                                id="guestDropdown"
                                role="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false"
                        >
                            <i class="fas fa-user-slash me-1"></i>
                            „Ç≤„Çπ„Éà„Å®„Åó„Å¶Èñ≤Ë¶ß‰∏≠
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="guestDropdown">
                            <li><a class="dropdown-item" th:href="@{/login}">
                                <i class="fas fa-right-to-bracket me-2"></i> „É≠„Ç∞„Ç§„É≥</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ „Å® „Éï„ÉÉ„Çø„Éº -->
    <div class="flex-grow-1 d-flex flex-column">
        <main class="bg-ivory px-4 py-3 flex-grow-1">
            <section layout:fragment="content"></section>
        </main>
        <footer class="bg-ivory-deep text-center py-3">
            <p class="mb-0">&copy; 2025 <strong>Takepii Library</strong></p>
        </footer>
    </div>

</div>
<div layout:fragment="scripts"></div>
</body>
</html>
