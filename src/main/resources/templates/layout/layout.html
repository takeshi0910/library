<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">図書館アプリ</title>
    <!-- 優先順を調整した書き方（Bootstrapを優先する場合） -->
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/webjars/vue/3.4.21/dist/vue.global.prod.js}"></script>
    <script th:src="@{/webjars/axios/1.6.7/dist/axios.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.bundle.min.js}"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script th:src="@{/js/common.js}"></script>

    <!-- layout.html の <head> 内 -->
    <!-- ▼ header.html 専用CSS（ドロップダウン演出） -->
    <style>
        .dropdown-menu {
          opacity: 0;
          transform: translateY(-5px);
          transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .dropdown-menu.show {
          opacity: 1;
          transform: translateY(0);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>

</head>
<!-- javascriptでの権限情報参照用に、data-role属性を埋め込む -->
<body th:attr="data-role=${#authentication.authorities.?[getAuthority() == 'ROLE_ADMIN'].size() > 0 ? 'ADMIN' : 'USER'}">

<!-- layout.html の <body> の末尾 -->
<!-- ▼ header.html 専用JS（ドロップダウン演出） -->
<script>
    const dropdown = document.getElementById('userDropdown');
    if (dropdown) {
      dropdown.addEventListener('show.bs.dropdown', function () {
        const menu = document.querySelector('.dropdown-menu');
        if (menu) menu.classList.add('show');
      });

      dropdown.addEventListener('hide.bs.dropdown', function () {
        const menu = document.querySelector('.dropdown-menu');
        if (menu) menu.classList.remove('show');
      });
    }
</script>
<div class="wrapper d-flex min-vh-100">

    <!-- ヘッダー -->
    <div th:replace="layout/header :: header"></div>

    <!-- コンテンツ領域（サイドバー＋メイン） -->
    <div class="d-flex flex-grow-1">
        <!-- サイドバー -->
        <div class="sidebar" th:replace="layout/sidebar :: sidebar"></div>

        <!-- メインコンテンツ と フッター -->
        <div class="flex-grow-1 d-flex flex-column">
            <main class="bg-ivory px-4 py-3 flex-grow-1">
                <section layout:fragment="content"></section>
            </main>
            <footer class="bg-ivory-deep text-center py-3">
                <p class="mb-0">&copy; 2025 <strong>Takepii Library</strong></p>
            </footer>
        </div>
    </div>

</div>
<div layout:fragment="scripts"></div>
</body>
</html>
